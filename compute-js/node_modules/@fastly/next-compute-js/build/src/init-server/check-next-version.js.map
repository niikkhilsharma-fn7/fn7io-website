{"version":3,"file":"check-next-version.js","sourceRoot":"","sources":["../../../src/init-server/check-next-version.ts"],"names":[],"mappings":";;;AAAA,MAAM,EAAE,IAAI,EAAE,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAEnC,gDAAgD;AAChD,+DAA+D;AAC/D,mEAAmE;AAEnE,MAAM,aAAa,GAAG,OAAO,CAAC;AAE9B,MAAM,aAAa,GAAwB,IAAI,GAAG,CAAiB;IACjE,CAAC,QAAQ,EAAE,cAAc,CAAC;IAC1B,CAAC,QAAQ,EAAE,OAAO,CAAC;IACnB,CAAC,QAAQ,EAAE,OAAO,CAAC;IACnB,CAAC,QAAQ,EAAE,aAAa,CAAC;CAC1B,CAAC,CAAC;AAEH,MAAM,mBAAmB,GAAG,CAAC,GAAG,aAAa,CAAC,IAAI,EAAE,CAAC,CAAC,GAAG,EAAE,CAAC;AAE5D,SAAgB,gBAAgB;IAE9B,IAAI,QAAgB,CAAC;IACrB,IAAI;QACF,QAAQ,GAAG,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;KACpC;IAAC,WAAM;QACN,OAAO,CAAC,KAAK,CAAC,+BAA+B,CAAC,CAAC;QAC/C,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;KACjB;IAED,IAAI,WAA+B,CAAC;IACpC,IAAI;QACF,MAAM,WAAW,GAAG,OAAO,CAAC,IAAI,CAAC,EAAC,GAAG,EAAE,QAAQ,EAAC,CAAC,CAAC,CAAC;QACnD,WAAW,GAAG,WAAW,CAAC,OAAiB,CAAC;KAC7C;IAAC,WAAM;QACN,OAAO,CAAC,IAAI,CAAC,yCAAyC,CAAC,CAAC;QACxD,WAAW,GAAG,SAAS,CAAC;KACzB;IAED,IAAI,WAAW,IAAI,IAAI,EAAE;QACvB,MAAM,qBAAqB,GAAG,aAAa,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;QAC7D,OAAO,CAAC,GAAG,CAAC,mBAAmB,GAAG,WAAW,CAAC,CAAC;QAC/C,IAAG,qBAAqB,IAAI,IAAI,EAAE;YAChC,IAAG,qBAAqB,KAAK,aAAa,EAAE;gBAC1C,OAAO;aACR;iBAAM;gBACL,OAAO,CAAC,IAAI,CAAC,kFAAkF,CAAC,CAAC;gBACjG,OAAO,CAAC,IAAI,CAAC,yCAAyC,GAAG,qBAAqB,GAAG,GAAG,CAAC,CAAC;aACvF;SACF;aAAM;YACL,OAAO,CAAC,IAAI,CAAC,mEAAmE,CAAC,CAAC;YAClF,OAAO,CAAC,IAAI,CAAC,uCAAuC,GAAG,mBAAmB,CAAC,CAAC;SAC7E;KACF;IACD,OAAO,CAAC,IAAI,CAAC,yFAAyF,CAAC,CAAC;IACxG,OAAO,CAAC,IAAI,CAAC,0EAA0E,CAAC,CAAC;AAC3F,CAAC;AApCD,4CAoCC","sourcesContent":["const { sync } = require('pkg-up');\n\n// TODO: Add to this table every time we release\n// The keys are Next.js versions, and the values are the newest\n// version of next-compute-js that is compatible with that version.\n\nconst newestVersion = '0.9.0';\n\nconst versionMatrix: Map<string, string> = new Map<string, string>([\n  ['12.2.2', '0.1.1-beta.4'],\n  ['12.2.4', '0.2.5'],\n  ['12.2.5', '0.2.5'],\n  ['12.3.0', newestVersion],\n]);\n\nconst newestNextjsVersion = [...versionMatrix.keys()].pop();\n\nexport function checkNextVersion() {\n\n  let nextFile: string;\n  try {\n    nextFile = require.resolve('next');\n  } catch {\n    console.error('This program requires Next.js');\n    process.exit(1);\n  }\n\n  let nextVersion: string | undefined;\n  try {\n    const packageJson = require(sync({cwd: nextFile}));\n    nextVersion = packageJson.version as string;\n  } catch {\n    console.warn('Could not determine version of Next.js.');\n    nextVersion = undefined;\n  }\n\n  if (nextVersion != null) {\n    const compatibleVersionInfo = versionMatrix.get(nextVersion);\n    console.log('Next.js version: ' + nextVersion);\n    if(compatibleVersionInfo != null) {\n      if(compatibleVersionInfo === newestVersion) {\n        return;\n      } else {\n        console.warn('The current version of next-compute-js does not support this version of Next.js.');\n        console.warn('Consider using @fastly/next-compute-js@' + compatibleVersionInfo + '.');\n      }\n    } else {\n      console.warn('@fastly/next-compute-js does not support this version of Next.js.');\n      console.warn('The version of Next.js supported is: ' + newestNextjsVersion);\n    }\n  }\n  console.warn('If you have trouble, try updating your installed version of @fastly/next-compute-js, or');\n  console.warn('check the README on GitHub at https://github.com/fastly/next-compute-js.');\n}\n"]}