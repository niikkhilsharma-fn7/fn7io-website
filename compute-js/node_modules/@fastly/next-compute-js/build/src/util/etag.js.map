{"version":3,"file":"etag.js","sourceRoot":"","sources":["../../../src/util/etag.ts"],"names":[],"mappings":";AAAA;;;;;GAKG;;;;;AAEH,mCAAgC;AAChC,oDAA4B;AAE5B;;;;GAIG;AACH,SAAwB,YAAY,CAAC,OAAe;IAClD,IAAI,OAAO,CAAC,MAAM,KAAK,CAAC,EAAE;QACxB,kBAAkB;QAClB,OAAO,iCAAiC,CAAC;KAC1C;IAED,yBAAyB;IACzB,qDAAqD;IACrD,+BAA+B;IAC/B,MAAM,IAAI,GAAG,gBAAM;SAChB,UAAU,CAAC,MAAM,CAAC;SAClB,MAAM,CAAC,OAAO,EAAE,MAAM,CAAC;SACvB,MAAM,CAAC,QAAQ,CAAC;SAChB,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;IAEpB,2BAA2B;IAC3B,MAAM,GAAG,GAAW,eAAM,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;IAE/C,OAAO,GAAG,GAAG,GAAG,CAAC,QAAQ,CAAC,EAAE,CAAC,GAAG,GAAG,GAAG,IAAI,GAAG,GAAG,CAAC;AACnD,CAAC;AAnBD,+BAmBC","sourcesContent":["/*\n * Copyright Fastly, Inc.\n * Licensed under the MIT license. See LICENSE file for details.\n *\n * Portions of this file Copyright Vercel, Inc., licensed under the MIT license. See LICENSE file for details.\n */\n\nimport { Buffer } from 'buffer';\nimport crypto from 'crypto';\n\n/**\n * Generates an etag string based on a payload.\n * (An adaptation for Compute of function in Next.js of the same name,\n * found at next/server/api-utils/web.ts)\n */\nexport default function generateETag(payload: string) {\n  if (payload.length === 0) {\n    // fast-path empty\n    return '\"0-2jmj7l5rSw0yVb/vlWAYkK/YBwk\"';\n  }\n\n  // compute hash of entity\n  // Do this without using crypto.subtle, as the crypto\n  // polyfill doesn't support it.\n  const hash = crypto\n    .createHash('sha1')\n    .update(payload, 'utf8')\n    .digest('base64')\n    .substring(0, 27);\n\n  // compute length of entity\n  const len: number = Buffer.byteLength(payload);\n\n  return '\"' + len.toString(16) + '-' + hash + '\"';\n}\n"]}